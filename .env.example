# Health Export REST API Environment Configuration (Rust/Actix-web)
# PostgreSQL Database Configuration

# Primary Database URL for Rust application
DATABASE_URL=postgresql://username:password@localhost:5432/database_name

# Test Database URL for running Rust tests
TEST_DATABASE_URL=postgresql://username:password@localhost:5432/test_database_name

# Database Connection Pool Settings
DATABASE_MAX_CONNECTIONS=20
DATABASE_MIN_CONNECTIONS=5
DATABASE_CONNECT_TIMEOUT=10
DATABASE_IDLE_TIMEOUT=300
DATABASE_MAX_LIFETIME=3600

# Redis Configuration
REDIS_URL=redis://localhost:6379
REDIS_POOL_SIZE=10
REDIS_TIMEOUT=5

# Application Configuration
RUST_LOG=info
SERVER_HOST=0.0.0.0
SERVER_PORT=8080
WORKERS=4

# Security Configuration
API_KEY_HASH_MEMORY=19456
API_KEY_HASH_ITERATIONS=2
API_KEY_HASH_PARALLELISM=1

# Rate Limiting Configuration
RATE_LIMIT_REQUESTS_PER_HOUR=100
RATE_LIMIT_BANDWIDTH_MB_PER_HOUR=10

# IP-based rate limiting for unauthenticated requests  
# Increased from 20 to 100 to resolve iOS upload failures (AUDIT-001)
RATE_LIMIT_IP_REQUESTS_PER_HOUR=100

# Per-user rate limiting (instead of per-IP for authenticated requests)
# Set to true to use user-based rate limiting for authenticated requests
RATE_LIMIT_USE_USER_BASED=false

# Request Timeout Configuration (Cloudflare 100s limit)
# Keep under 100 seconds to prevent Cloudflare timeout
REQUEST_TIMEOUT_SECONDS=90

# Batch Processing Configuration
# Retry settings for failed batch operations
BATCH_MAX_RETRIES=3
BATCH_INITIAL_BACKOFF_MS=100
BATCH_MAX_BACKOFF_MS=5000

# Parallel processing and memory settings
BATCH_ENABLE_PARALLEL=true
BATCH_CHUNK_SIZE=1000
BATCH_MEMORY_LIMIT_MB=500.0

# Metric-specific chunk sizes (PostgreSQL parameter limits)
# Heart Rate: 6 params per record, safe chunk size: ~8000
BATCH_HEART_RATE_CHUNK_SIZE=8000
# Blood Pressure: 6 params per record, safe chunk size: ~8000
BATCH_BLOOD_PRESSURE_CHUNK_SIZE=8000
# Sleep: 10 params per record, safe chunk size: ~5000
BATCH_SLEEP_CHUNK_SIZE=5000
# Activity: 7 params per record, safe chunk size: ~7000
BATCH_ACTIVITY_CHUNK_SIZE=7000
# Workout: 10 params per record, safe chunk size: ~5000
BATCH_WORKOUT_CHUNK_SIZE=5000

# Progress tracking and deduplication
BATCH_ENABLE_PROGRESS_TRACKING=true
BATCH_ENABLE_DEDUPLICATION=true

# Health Metric Validation Thresholds
# Heart Rate validation ranges (BPM)
VALIDATION_HEART_RATE_MIN=15
VALIDATION_HEART_RATE_MAX=300

# Blood Pressure validation ranges (mmHg)
VALIDATION_SYSTOLIC_MIN=50
VALIDATION_SYSTOLIC_MAX=250
VALIDATION_DIASTOLIC_MIN=30
VALIDATION_DIASTOLIC_MAX=150

# Sleep validation thresholds
VALIDATION_SLEEP_EFFICIENCY_MIN=0.0
VALIDATION_SLEEP_EFFICIENCY_MAX=100.0
VALIDATION_SLEEP_DURATION_TOLERANCE_MINUTES=60

# Activity validation limits
VALIDATION_STEPS_MIN=0
VALIDATION_STEPS_MAX=200000
VALIDATION_DISTANCE_MAX_KM=500.0
VALIDATION_CALORIES_MAX=20000.0

# GPS coordinate validation ranges
VALIDATION_LATITUDE_MIN=-90.0
VALIDATION_LATITUDE_MAX=90.0
VALIDATION_LONGITUDE_MIN=-180.0
VALIDATION_LONGITUDE_MAX=180.0

# Workout validation settings
VALIDATION_WORKOUT_HEART_RATE_MIN=15
VALIDATION_WORKOUT_HEART_RATE_MAX=300
VALIDATION_WORKOUT_MAX_DURATION_HOURS=24

# Connection Timeout Configuration for Cloudflare 520 error prevention
CONNECTION_TIMEOUT_SECONDS=30
KEEP_ALIVE_TIMEOUT_SECONDS=75
CLIENT_SHUTDOWN_TIMEOUT_SECONDS=30
SERVER_SHUTDOWN_TIMEOUT_SECONDS=30

# Monitoring Configuration
METRICS_PORT=9090
LOG_LEVEL=info

# Development/Production Environment
ENVIRONMENT=development

# CORS Security Configuration
# Comma-separated list of allowed origins (no spaces)
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001,https://localhost:3000,https://localhost:3001
# Max age for preflight requests (seconds)
CORS_MAX_AGE=3600
# Allow credentials (true/false) - use with caution
CORS_ALLOW_CREDENTIALS=false

# Optional: Database SSL Configuration (uncomment for production)
# DATABASE_SSL_MODE=require
# DATABASE_SSL_CERT_PATH=/path/to/cert.pem
# DATABASE_SSL_KEY_PATH=/path/to/key.pem
# DATABASE_SSL_CA_PATH=/path/to/ca.pem